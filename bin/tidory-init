#!/usr/bin/env node
/* eslint-disable no-console */

const shelljs = require('shelljs')
const ora = require('ora')
const colors = require('colors')
const download = require('download-git-repo')
const pkg = require('../package.json')
const path = require('path')

console.log('\n\0\0Thank you for using Tidory\n'.yellow.bold);

/**
 * Download template, Install node modules
 */

const spinner = ora('Trying to copy template from git...\n');
spinner.start();

download('github:pronist/tidory', path.join(process.cwd(), 'tidory'), false, function(err) {
  if(err) {
    spinner.stopAndPersist({ text:`\n\0\0${stderr}\n`.red.bold });
  }
  else {
    spinner.stopAndPersist({ 
      text:`Successful\n`.green.bold 
    });
    // install npm modules
    spinner.start('installing node modules...\n');
    shelljs.exec('cd tidory && npm install --silent', function(code, stdout, stderr) {
      if(stderr) {
        spinner.stopAndPersist({
          text:`\n\0\0${stderr}`.red.bold 
        });
      }
      else {
        spinner.stopAndPersist({
          text:`\n\0\0Now, make your own Tistory Skin!\n`.green.bold
        });
      }
    });
  }
})